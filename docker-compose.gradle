def BUILD_DOCKER_GROUP = 'Build Docker'

task buildCluster() {
    group = BUILD_DOCKER_GROUP
    description = "Build all images for cluster with docker-compose"

    subprojects
        .each { dependsOn("${it.name}:build") }
    subprojects
        .findAll({it.name == "cluster-dao" || it.name == "cluster-web"})
        .each { dependsOn("${it.name}:copyProdLoggingConfiguration") }

    doLast {
        exec {
			executable = "docker-compose"
			args = ["build"]
		}
    }
}

task startCluster() {
    group = BUILD_DOCKER_GROUP
    description = "Build and run all images for cluster with docker-compose"

    dependsOn 'buildCluster'

    doLast {
        exec {
			executable = "docker-compose"
			args = ["up", "-d"]
		}
    }
}

task stopCluster() {
    group = BUILD_DOCKER_GROUP
    description = "Stop all images for cluster with docker-compose"

    doLast {
        exec {
			executable = "docker-compose"
			args = ["down", "--volumes", "--remove-orphans"]
		}
    }
}